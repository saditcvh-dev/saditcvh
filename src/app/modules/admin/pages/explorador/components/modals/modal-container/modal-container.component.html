<!-- Backdrop -->
<div *ngIf="showModal" class="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/40 dark:bg-gray-800/60" (click)="onCloseModal()">
	<!-- Contenido del Modal -->
	<div class="relative bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-hidden animate-in zoom-in-95 duration-200 border border-gray-100 dark:border-neutral-700" (click)="$event.stopPropagation()">
		<!-- Header -->
		<div class="px-6 py-4 bg-gray-50 dark:bg-gray-800 border-b border-gray-100 dark:border-neutral-700 flex justify-between items-center">
			<h3 class="text-lg font-bold text-gray-800 dark:text-neutral-100">
				{{ modalTitle }}
			</h3>
			<button (click)="onCloseModal()" class="text-gray-400 dark:text-neutral-400 hover:text-gray-600 dark:hover:text-neutral-200 transition-colors p-1 rounded-full hover:bg-gray-200 dark:hover:bg-neutral-700">
				<svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
				</svg>
			</button>
		</div>
		<!-- Body -->
		<div class="p-6 overflow-y-auto max-h-[calc(90vh-140px)] bg-white dark:bg-gray-800">
			<!-- Modal de Subida (Versión o Nuevo Documento) -->
			<div *ngIf="activeModalType === 'upload' || activeModalType === 'create_documento'" class="space-y-4">
				<!-- Versión Modal -->
				<div *ngIf="isVersionModal" class="space-y-4">
					<div class="mb-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg">
						<p class="text-sm text-gray-600 dark:text-neutral-300"> Subir nueva versión para: <span class="font-medium">{{ getSelectedNodeName() }}</span>
						</p>
						<p class="text-xs text-gray-500 dark:text-neutral-400 mt-1"> Se creará una nueva versión del documento actual </p>
					</div>
					<app-upload-modal [selectedFile]="selectedFile" [isDragging]="isDragging" [isUploading]="isUploading" (fileSelected)="onFileSelected($event)" (fileDropped)="onFileDrop($event)" (dragOver)="onDragOver($event)" (dragLeave)="onDragLeave($event)" (clearFile)="onClearFile($event)">
					</app-upload-modal>
				</div>
				<!-- Nuevo Documento Modal -->
				<div *ngIf="isNewDocumentModal" class="space-y-4">
					<div class="mb-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg">
						<p class="text-sm text-gray-600 dark:text-neutral-300"> Documento: <span class="font-medium">{{ getSelectedNodeName() }}</span>
						</p>
						<p class="text-xs text-gray-500 dark:text-neutral-400 mt-1"> Numero Autorización: {{ selectedNode?.data?.numeroAutorizacion || 'N/A' }}
						</p>
					</div>
					<app-upload-modal [selectedFile]="selectedFile" [isDragging]="isDragging" [isUploading]="isUploading" (fileSelected)="onFileSelected($event)" (fileDropped)="onFileDrop($event)" (dragOver)="onDragOver($event)" (dragLeave)="onDragLeave($event)" (clearFile)="onClearFile($event)">
					</app-upload-modal>
				</div>
			</div>
			<!-- Modal de Crear Autorización -->
			<div *ngIf="activeModalType === 'create_autorizacion'">
				<app-create-autorizacion-modal [modalState]="modalState" [modalidades]="modalidades" [tiposAutorizacion]="tiposAutorizacion" (dataChange)="onModalDataChange($event)">
				</app-create-autorizacion-modal>
			</div>
			<!-- Modal de Confirmación de Eliminación -->
			<!-- <div *ngIf="activeModalType === 'delete'">
        <app-delete-confirmation-modal
          [modalState]="modalState">
        </app-delete-confirmation-modal>
      </div> -->
		</div>
		<!-- Footer -->
		<div class="px-6 py-4 bg-gray-50 dark:bg-gray-800 border-t border-gray-100 dark:border-neutral-700 flex justify-end gap-3">
			<!-- Botón Cancelar -->
			<button (click)="onCloseModal()" class="px-4 py-2 border border-gray-300 dark:border-neutral-600 text-gray-700 dark:text-neutral-300 rounded-lg text-sm font-medium transition-colors hover:bg-gray-50 dark:hover:bg-neutral-700"> Cancelar </button>
			<!-- Botón de Acción Principal -->
			<button *ngIf="activeModalType === 'upload'" (click)="onUploadFile()" [disabled]="!selectedFile || isUploading" [class.opacity-50]="!selectedFile || isUploading" [class.cursor-not-allowed]="!selectedFile || isUploading" class="px-4 py-2 bg-[#691831] text-white rounded-lg text-sm font-medium transition-colors shadow-sm flex items-center gap-2 hover:bg-[#501225]">
				<svg *ngIf="isUploading" class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24">
					<circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
					<path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
				</svg>
				{{ uploadButtonText }}
			</button>
			<button *ngIf="activeModalType !== 'upload' && activeModalType !== null" (click)="onModalAction()" [disabled]="isUploading" [class.opacity-50]="isUploading" [class.cursor-not-allowed]="isUploading" class="px-4 py-2 bg-[#691831] text-white rounded-lg text-sm font-medium transition-colors shadow-sm flex items-center gap-2 hover:bg-[#501225]">
				<svg *ngIf="isUploading" class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24">
					<circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
					<path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
				</svg>
				{{ actionButtonText }}
			</button>
		</div>
		<!-- Input de archivo oculto -->
		<input #fileInput type="file" class="hidden" (change)="onFileSelected($event)" accept=".pdf,.jpg,.jpeg,.png,.tiff,.tif,.doc,.docx">
	</div>
</div>