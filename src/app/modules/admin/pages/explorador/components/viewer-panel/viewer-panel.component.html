<div *ngIf="selectedNode" class="flex flex-col h-full relative">
  <!-- ENCABEZADO PRINCIPAL - Solo breadcrumb e información del nodo -->
  <div *ngIf="showMainHeader"
    class="bg-white dark:bg-black border-b border-gray-200 dark:border-neutral-900 transition-all duration-300 ease-in-out shrink-0">
    <!-- Breadcrumb -->
    <div class="px-6 pt-4 pb-0 text-xs text-gray-400 dark:text-neutral-500 flex items-center gap-2 select-none flex-wrap">
      <span class="hover:text-[#691831] dark:hover:text-blue-400 cursor-pointer transition-colors truncate max-w-[150px] whitespace-nowrap"
        (click)="onBreadcrumbClick(null)">
        Inicio
      </span>
      <ng-container *ngFor="let crumb of breadcrumbs; let i = index">
        <svg class="w-3 h-3 text-gray-300 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
        <span class="hover:text-[#691831] cursor-pointer transition-colors truncate max-w-[150px] whitespace-nowrap"
          (click)="onBreadcrumbClick(crumb.node)" [class.font-bold]="i === breadcrumbs.length - 1"
          [class.text-gray-600]="i === breadcrumbs.length - 1"
          [class.dark:text-neutral-300]="i === breadcrumbs.length - 1">
          {{ crumb.name }}
        </span>
      </ng-container>
    </div>

    <!-- Información del nodo -->
    <div class="px-6 py-4 flex justify-between items-start">
      <div class="flex items-start gap-3">
        <!-- Icono -->
        <div class="mt-1 relative">
          <img [src]="getNodeIcon(selectedNode)" class="w-8 h-8" alt="Icono de {{ nodeTypeLabel }}"
            onerror="this.src='/assets/icons/file.svg'">
        </div>

        <!-- Título y tipo -->
        <div>
          <div class="flex items-center gap-3">
            <h1 class="text-xl font-bold text-gray-800 dark:text-neutral-100">{{ selectedNode.nombre }}</h1>
            <span class="px-2 py-0.5 rounded text-[10px] font-bold uppercase border" [class]="nodeTypeColor">
              {{ nodeTypeLabel }}
            </span>
          </div>

          <p class="text-xs text-gray-500 dark:text-neutral-500 mt-1 uppercase font-mono">{{ selectedNode.id }}</p>

          <!-- Información adicional -->
          <div *ngIf="selectedNode.data" class="mt-2 text-xs text-gray-600 dark:text-neutral-400 space-y-1">
            <div *ngIf="selectedNode.data.solicitante" class="flex items-center gap-1">
              <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
              <span>Solicitante: {{ selectedNode.data.solicitante }}</span>
            </div>
            <div *ngIf="selectedNode.data.fecha_creacion" class="flex items-center gap-1">
              <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <span>Creado: {{ formatDate(selectedNode.data.fecha_creacion) }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- NAVEGACIÓN DE PESTAÑAS - SIEMPRE VISIBLE -->
  <app-tabs-navigation [showMainHeader]="showMainHeader" [showControlPanel]="showControlPanel"
    *ngIf="shouldShowTabs()" [class.border-t]="!showMainHeader" [class.border-b]="showMainHeader"
    [selectedNode]="selectedNode" [activeTab]="activeTab" [allowedTabs]="allowedTabs"
    (tabChange)="onTabChange($event)" (showMainHeaderChange)="onShowMainHeaderChange($event)"
    (showControlPanelChange)="onShowControlPanelChange($event)" class="shrink-0">
  </app-tabs-navigation>

  <!-- Contenido de la pestaña activa -->
  <div class="flex-1 min-h-0 bg-gray-50 dark:bg-black overflow-hidden transition-all duration-300 ease-in-out"
    [class]="showMainHeader ? 'mt-0' : ''">
    <!-- Vista Previa -->
    <div *ngIf="activeTab === 'preview'" class="h-full flex flex-col">
      <app-preview-tab [selectedNode]="selectedNode" [pdfUrl]="pdfUrl" 
        class="flex-1 min-h-0">
      </app-preview-tab>
    </div>

    <!-- Los demás tabs permanecen igual -->
    <ng-container *ngIf="activeTab !== 'preview'">
      <!-- Metadatos -->
      <div *ngIf="activeTab === 'metadata'" class="h-full">
        <app-metadata-tab [selectedNode]="selectedNode" [fullScreenMode]="!showMainHeader">
        </app-metadata-tab>
      </div>

      <!-- Seguridad -->
      <div *ngIf="activeTab === 'security'" class="h-full">
        <app-security-tab [selectedNode]="selectedNode" [fullScreenMode]="!showMainHeader">
        </app-security-tab>
      </div>

      <!-- Historial -->
      <div *ngIf="activeTab === 'history' && selectedNode.type === 'autorizacion'" class="h-full">
        <app-history-tab [selectedNode]="selectedNode" [documentVersions]="documentVersions"
          (openUploadModal)="onOpenUploadModal()" (downloadVersion)="onDownloadVersion($event)"
          (restoreVersion)="onRestoreVersion($event)" [fullScreenMode]="!showMainHeader"   (versionCreated)="reloadVersions()"
>
        </app-history-tab>
      </div>

      <!-- Notas -->
      <div *ngIf="activeTab === 'notes'" class="h-full overflow-y-auto p-6 bg-white dark:bg-neutral-900">
        <div class="flex flex-col items-center justify-center h-full text-gray-400 dark:text-neutral-500">
          <svg class="w-16 h-16 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
              d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />
          </svg>
          <p class="text-lg font-medium mb-2">Notas</p>
          <p class="text-sm text-center max-w-md">
            Aquí puedes agregar y gestionar notas relacionadas con este documento.
          </p>
        </div>
      </div>
    </ng-container>
  </div>
</div>