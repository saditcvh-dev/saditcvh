<div class="h-full overflow-y-auto bg-white dark:bg-[#131314] custom-scrollbar scrollbar-hide">
	<!-- Sin selección -->
	<ng-container *ngIf="!selectedNode; else withSelection">
		<div class="flex flex-col items-center justify-center h-full text-gray-400">
			<svg class="w-16 h-16 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
					d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z" />
			</svg>
			<p class="text-lg">Selecciona un elemento para ver detalles</p>
		</div>
	</ng-container>

	<ng-template #withSelection>
		<!-- Autorización -->
		<ng-container *ngIf="isAutorizacion; else otherNode">
			<!-- PDF con vista previa -->
			<ng-container *ngIf="hasPreview; else noPreview">
				<!-- VISOR SIMPLE DE PDF -->
				<div class="flex flex-col h-full">
					<!-- BARRA SUPERIOR -->
					<div class="bg-white dark:bg-[#101010] border-b border-gray-200 dark:border-gray-800 
						px-3 py-2 flex items-center justify-between text-xs">

						<!-- Información del documento -->
						<div class="flex items-center space-x-3">
							<div *ngIf="pdfUrl" class="flex items-center">
								<svg class="w-4 h-4 text-gray-600 dark:text-gray-400 mr-2" fill="none"
									stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
										d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" />
								</svg>
								<span class="text-xs text-gray-900 dark:text-gray-100 truncate max-w-xs">
									{{ currentFileName || selectedNode?.nombre || 'Documento PDF' }}
								</span>
							</div>
						</div>

						<!-- Botones de acción -->
						<div class="flex items-center space-x-2">
							<!-- Botón para mostrar/ocultar comentarios -->
							<button (click)="toggleCommentsPanel()"
								class="flex items-center px-3 py-1.5 text-xs bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 text-gray-800 dark:text-gray-200 rounded hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-gray-100">
								<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" stroke-width="2"
									viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round"
										d="M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 01-2.555-.337A5.972 5.972 0 015.41 20.97a5.969 5.969 0 01-.474-.065 4.48 4.48 0 00.978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25z" />
								</svg>
								{{ showCommentsPanel ? 'Ocultar' : 'Mostrar' }} Comentarios
							</button>

							<!-- Botón de pantalla completa -->
							<button (click)="toggleFullscreen()" *ngIf="pdfUrl"
								class="flex items-center px-3 py-1.5 text-xs bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 text-gray-800 dark:text-gray-200 rounded hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-gray-100">
								<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" stroke-width="2"
									viewBox="0 0 24 24">
									<path *ngIf="!isFullscreen" stroke-linecap="round" stroke-linejoin="round"
										d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15" />
									<path *ngIf="isFullscreen" stroke-linecap="round" stroke-linejoin="round"
										d="M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25" />
								</svg>
								{{ isFullscreen ? 'Salir' : 'Pantalla completa' }}
							</button>
						</div>
					</div>

					<!-- CONTENIDO PRINCIPAL -->
					<div class="flex flex-1">
						<!-- ÁREA PRINCIPAL DEL PDF -->
						<div class="relative bg-gray-100 dark:bg-gray-900 flex-1"
							[class]="showCommentsPanel ? 'w-2/3' : 'w-full'">

							<!-- Loading -->
							<div *ngIf="isLoading" class="absolute top-0 left-0 z-20 w-full">
								<div class="h-1 w-full bg-gray-200 overflow-hidden">
									<div class="h-full w-1/3 bg-blue-500 animate-[loading_1.2s_ease-in-out_infinite]">
									</div>
								</div>
							</div>

							<!-- Error -->
							<div *ngIf="hasError()"
								class="absolute inset-0 flex flex-col items-center justify-center bg-white/90 dark:bg-gray-900/90 z-10 p-4">
								<svg class="w-12 h-12 text-red-500 mb-4" fill="none" stroke="currentColor"
									stroke-width="2" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round"
										d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
								</svg>
								<p class="text-sm text-gray-900 dark:text-gray-100 mb-2">Error al cargar el PDF</p>
							</div>

							<!-- PDF usando object/iframe -->
							<div *ngIf="pdfUrl && !isLoading && !hasError()" class="w-full"
								style="height: calc(100vh - 160px);">
								<!-- Usando iframe en lugar de object para mejor compatibilidad -->
								<iframe [src]="pdfUrl" class="w-full h-full border-0" frameborder="0" allow="fullscreen"
									title="Vista previa del PDF - {{ currentFileName }}" (load)="onIframeLoad()"
									(error)="onIframeError()" #pdfIframe>
									<p>Tu navegador no soporta iframes.
										<a [href]="pdfUrl" target="_blank" class="text-blue-600 hover:text-blue-800">
											Descarga el PDF
										</a>
									</p>
								</iframe>
							</div>
						</div>

						<!-- PANEL DE COMENTARIOS (DERECHA) -->
						<div *ngIf="showCommentsPanel"
							class=" w-80 bg-white dark:bg-gray-900 border-l border-gray-200 dark:border-gray-800 flex flex-col">
							<!-- Header del panel de comentarios -->
							<div
								class="p-4 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between">
								<h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100">Comentarios</h3>
								<button (click)="toggleCommentsPanel()"
									class="text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100">
									<svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2"
										viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
									</svg>
								</button>
							</div>

							<!-- Contenido del panel de comentarios -->
							<div class="flex-1 " style="height: calc(100vh - 220px); ">
								<app-comentarios [pdfUrl]="pdfUrl">
								</app-comentarios>
							</div>
						</div>
					</div>
				</div>
			</ng-container>

			<!-- Sin archivo -->
			<ng-template #noPreview>
				<div class="flex flex-col items-center justify-center h-full text-gray-400 dark:text-gray-500">
					<svg class="w-16 h-16 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
							d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
					</svg>
					<p class="text-lg">Sin vista previa disponible</p>
					<p class="text-sm mt-2">Sube un archivo para visualizarlo</p>
				</div>
			</ng-template>
		</ng-container>

		<!-- Otros nodos -->
		<ng-template #otherNode>
			<div class="flex flex-col items-center justify-center h-full text-gray-400 dark:text-gray-500">
				<div [innerHTML]="getNodeIcon(selectedNode)" class="w-16 h-16 mb-4"></div>
				<p class="text-lg">{{ selectedNode?.nombre }}</p>
				<!-- <p class="text-sm mt-2">{{ getNodeDescription(selectedNode) }}</p> -->
			</div>
		</ng-template>
	</ng-template>
</div>