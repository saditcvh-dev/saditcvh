<!-- BUSCADOR AVANZADO | EXPEDIENTES STCH -->
<div class="p-6">
    
    <!-- Título y Estadísticas -->
    <div class="mb-8">
        <h1 class="text-2xl font-bold text-gray-800 mb-2">Expedientes Digitalizados</h1>
        <p class="text-gray-600">30,000 expedientes | 14.19 millones de páginas | Sistema de Transporte Convencional de Hidalgo</p>
    </div>

    <!-- ============================================================
         FORMULARIO DE BÚSQUEDA AVANZADA
    ============================================================ -->
    <div class="bg-white rounded-xl border border-gray-200 p-6 shadow-sm mb-8">
        <h2 class="font-semibold text-gray-800 mb-6 text-lg">Búsqueda Avanzada</h2>
        
        <form id="formBusqueda" class="space-y-6">
            
            <!-- Fila 1: Búsqueda General -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <!-- Campo de búsqueda principal -->
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-search mr-2"></i>Palabras clave
                    </label>
                    <div class="relative">
                        <input 
                            type="text" 
                            id="busquedaGeneral"
                            placeholder="Buscar en todo el contenido (nombre, número, descripción...)"
                            class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        >
                        <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    </div>
                </div>
                
                <!-- Tipo de expediente -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-tag mr-2"></i>Tipo de expediente
                    </label>
                    <select title="Tipo de expediente" id="tipoExpediente" class="w-full border border-gray-300 rounded-lg py-3 px-4 focus:ring-2 focus:ring-blue-500">
                        <option value="">Todos los tipos</option>
                        <option value="licencia">Licencia de operación</option>
                        <option value="renovacion">Renovación de permiso</option>
                        <option value="inspeccion">Inspección vehicular</option>
                        <option value="ruta">Solicitud de ruta</option>
                        <option value="multa">Expediente de multa</option>
                        <option value="recurso">Recurso administrativo</option>
                    </select>
                </div>
            </div>

            <!-- Fila 2: Fechas -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Rango de fechas -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-calendar-alt mr-2"></i>Rango de fechas
                    </label>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-xs text-gray-500 mb-1 block">Desde</label>
                            <input 
                                title="Desde"
                                type="date" 
                                id="fechaDesde"
                                class="w-full border border-gray-300 rounded-lg py-2 px-3 focus:ring-2 focus:ring-blue-500"
                            >
                        </div>
                        <div>
                            <label class="text-xs text-gray-500 mb-1 block">Hasta</label>
                            <input
                                title="Hasta"
                                type="date" 
                                id="fechaHasta"
                                class="w-full border border-gray-300 rounded-lg py-2 px-3 focus:ring-2 focus:ring-blue-500"
                            >
                        </div>
                    </div>
                </div>
                
                <!-- Fecha específica -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-calendar-day mr-2"></i>Fecha específica
                    </label>
                    <div class="flex space-x-3">
                        <input
                            title="Fecha específica" 
                            type="date" 
                            id="fechaEspecifica"
                            class="flex-1 border border-gray-300 rounded-lg py-2 px-3 focus:ring-2 focus:ring-blue-500"
                        >
                        <button 
                            type="button" 
                            onclick="limpiarFechaEspecifica()"
                            class="px-4 py-2 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50"
                        >
                            Limpiar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Fila 3: Filtros adicionales -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Nombre del titular -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-user mr-2"></i>Nombre del titular
                    </label>
                    <input 
                        type="text" 
                        id="nombreTitular"
                        placeholder="Ej: Juan Pérez González"
                        class="w-full border border-gray-300 rounded-lg py-2 px-4 focus:ring-2 focus:ring-blue-500"
                    >
                </div>
                
                <!-- Número de expediente -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-hashtag mr-2"></i>Número de expediente
                    </label>
                    <input 
                        type="text" 
                        id="numeroExpediente"
                        placeholder="Ej: EXP-STCH-2025-04567"
                        class="w-full border border-gray-300 rounded-lg py-2 px-4 focus:ring-2 focus:ring-blue-500"
                    >
                </div>
                
                <!-- Estado -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-check-circle mr-2"></i>Estado
                    </label>
                    <select title="Estado" id="estadoExpediente" class="w-full border border-gray-300 rounded-lg py-2 px-4 focus:ring-2 focus:ring-blue-500">
                        <option value="">Todos los estados</option>
                        <option value="digitalizado">Digitalizado</option>
                        <option value="pendiente">Pendiente</option>
                        <option value="revision">En revisión</option>
                        <option value="archivado">Archivado</option>
                        <option value="eliminado">Eliminado</option>
                    </select>
                </div>
            </div>

            <!-- Fila 4: Búsqueda por metadatos -->
            <div class="border-t pt-6">
                <h3 class="text-sm font-medium text-gray-700 mb-4">
                    <i class="fas fa-database mr-2"></i>Búsqueda por metadatos específicos
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Placas vehiculares -->
                    <div>
                        <label class="text-xs text-gray-500 mb-1 block">Placa vehicular</label>
                        <input 
                            type="text" 
                            id="placaVehicular"
                            placeholder="Ej: HGO-1234"
                            class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm"
                        >
                    </div>
                    
                    <!-- Número de permiso -->
                    <div>
                        <label class="text-xs text-gray-500 mb-1 block">Número de permiso</label>
                        <input 
                            type="text" 
                            id="numeroPermiso"
                            placeholder="Ej: PERM-2025-789"
                            class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm"
                        >
                    </div>
                    
                    <!-- Ruta asignada -->
                    <div>
                        <label class="text-xs text-gray-500 mb-1 block">Ruta asignada</label>
                        <input 
                            type="text" 
                            id="rutaAsignada"
                            placeholder="Ej: Pachuca-Mineral del Monte"
                            class="w-full border border-gray-300 rounded-lg py-2 px-3 text-sm"
                        >
                    </div>
                </div>
            </div>

            <!-- Botones de acción -->
            <div class="flex flex-col sm:flex-row gap-3 pt-4 border-t">
                <button 
                    type="submit" 
                    class="flex-1 bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 font-medium flex items-center justify-center"
                >
                    <i class="fas fa-search mr-2"></i>Buscar Expedientes
                </button>
                
                <button 
                    type="button" 
                    onclick="limpiarBusqueda()"
                    class="flex-1 border border-gray-300 text-gray-700 py-3 px-6 rounded-lg hover:bg-gray-50 font-medium flex items-center justify-center"
                >
                    <i class="fas fa-eraser mr-2"></i>Limpiar Filtros
                </button>
                
                <button 
                    type="button" 
                    onclick="guardarBusqueda()"
                    class="flex-1 border border-blue-300 text-blue-600 py-3 px-6 rounded-lg hover:bg-blue-50 font-medium flex items-center justify-center"
                >
                    <i class="fas fa-save mr-2"></i>Guardar Búsqueda
                </button>
            </div>
        </form>
    </div>

    <!-- ============================================================
         RESULTADOS DE BÚSQUEDA
    ============================================================ -->
    <div class="bg-white rounded-xl border border-gray-200 shadow-sm">
        
        <!-- Header de resultados -->
        <div class="p-6 border-b">
            <div class="flex flex-col sm:flex-row sm:items-center justify-between">
                <div>
                    <h3 class="font-semibold text-gray-800">Resultados de búsqueda</h3>
                    <p id="contadorResultados" class="text-sm text-gray-500">Mostrando 0 expedientes</p>
                </div>
                
                <div class="flex items-center space-x-3 mt-3 sm:mt-0">
                    <select title="Filtro de busqueda" id="ordenResultados" class="border border-gray-300 rounded-lg py-2 px-3 text-sm">
                        <option value="fecha_desc">Más recientes primero</option>
                        <option value="fecha_asc">Más antiguos primero</option>
                        <option value="nombre_asc">Nombre (A-Z)</option>
                        <option value="nombre_desc">Nombre (Z-A)</option>
                    </select>
                    
                    <button 
                        id="btnExportar"
                        class="border border-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-50 text-sm font-medium flex items-center"
                    >
                        <i class="fas fa-file-export mr-2"></i>Exportar
                    </button>
                </div>
            </div>
        </div>

        <!-- Tabla de resultados -->
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            <input title="Check para resultados" type="checkbox" class="rounded border-gray-300">
                        </th>
                        <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Número de expediente
                        </th>
                        <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Titular
                        </th>
                        <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Tipo
                        </th>
                        <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Fecha de apertura
                        </th>
                        <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Estado
                        </th>
                        <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Acciones
                        </th>
                    </tr>
                </thead>
                <tbody id="tbodyResultados" class="bg-white divide-y divide-gray-200">
                    <!-- Los resultados se cargarán aquí dinámicamente -->
                    <tr id="mensajeSinResultados">
                        <td colspan="7" class="py-12 text-center">
                            <i class="fas fa-search text-4xl text-gray-300 mb-3"></i>
                            <p class="text-gray-500">Ingresa los criterios de búsqueda para encontrar expedientes</p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Paginación -->
        <div class="px-6 py-4 border-t">
            <div class="flex flex-col sm:flex-row sm:items-center justify-between">
                <div class="text-sm text-gray-500 mb-3 sm:mb-0">
                    Mostrando <span id="paginaInicio">0</span>-<span id="paginaFin">0</span> de <span id="totalRegistros">0</span> expedientes
                </div>
                
                <div class="flex items-center space-x-2">
                    <button title="Pagina" class="p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    
                    <div class="flex space-x-1">
                        <button class="w-8 h-8 rounded-lg bg-blue-600 text-white">1</button>
                        <button class="w-8 h-8 rounded-lg border border-gray-300 hover:bg-gray-50">2</button>
                        <button class="w-8 h-8 rounded-lg border border-gray-300 hover:bg-gray-50">3</button>
                        <span class="px-2">...</span>
                        <button class="w-8 h-8 rounded-lg border border-gray-300 hover:bg-gray-50">10</button>
                    </div>
                    
                    <button title="Pagina" class="p-2 rounded-lg border border-gray-300 hover:bg-gray-50">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================================
         BÚSQUEDAS GUARDADAS (sidebar colapsable)
    ============================================================ -->
    <div class="fixed right-0 top-1/2 transform -translate-y-1/2">
        <button 
            title="Busquedas guardadas"
            id="btnToggleBusquedas"
            class="bg-blue-600 text-white p-3 rounded-l-lg shadow-lg hover:bg-blue-700"
            onclick="toggleBusquedasGuardadas()"
        >
            <i class="fas fa-bookmark"></i>
        </button>
    </div>

    <div id="panelBusquedasGuardadas" class="fixed right-0 top-1/2 transform -translate-y-1/2 translate-x-full transition-transform duration-300 w-80 bg-white border-l border-gray-200 shadow-xl rounded-l-lg">
        <div class="p-4 border-b">
            <div class="flex justify-between items-center">
                <h4 class="font-medium text-gray-800">Búsquedas guardadas</h4>
                <button title="Busquedas guardadas" onclick="toggleBusquedasGuardadas()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="p-4 space-y-3 max-h-96 overflow-y-auto">
            <!-- Las búsquedas guardadas se cargarán aquí -->
            <div class="text-center text-gray-500 py-8">
                <i class="fas fa-bookmark text-2xl mb-2"></i>
                <p class="text-sm">No hay búsquedas guardadas</p>
            </div>
        </div>
    </div>
</div>

<!-- Modal para detalles del expediente -->
<div id="modalDetalles" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
        <div class="p-6 border-b">
            <div class="flex justify-between items-center">
                <h3 class="text-xl font-bold text-gray-800">Detalles del expediente</h3>
                <button title="Detalles del expediente" onclick="cerrarModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
        </div>
        <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
            <!-- Contenido del modal se cargará dinámicamente -->
            <div id="contenidoModal"></div>
        </div>
    </div>
</div>

<script>
// Datos de ejemplo para demostración
const expedientesEjemplo = [
    {
        id: 1,
        numero: "EXP-STCH-2025-04567",
        titular: "Juan Pérez González",
        tipo: "Licencia de operación",
        fechaApertura: "2025-01-15",
        fechaCierre: "2025-02-20",
        estado: "digitalizado",
        placa: "HGO-7890",
        permiso: "PERM-2025-123",
        ruta: "Pachuca-Mineral del Monte",
        paginas: 45,
        descripcion: "Licencia de operación para transporte de pasajeros"
    },
    {
        id: 2,
        numero: "EXP-STCH-2025-04568",
        titular: "Transportes Hidalgo S.A. de C.V.",
        tipo: "Renovación de permiso",
        fechaApertura: "2025-01-20",
        fechaCierre: null,
        estado: "revision",
        placa: "HGO-4567, HGO-4568",
        permiso: "PERM-2024-789",
        ruta: "Pachuca-Tulancingo",
        paginas: 120,
        descripcion: "Renovación de permiso para flotilla de 5 unidades"
    },
    {
        id: 3,
        numero: "EXP-STCH-2025-04569",
        titular: "María González Rodríguez",
        tipo: "Inspección vehicular",
        fechaApertura: "2025-02-01",
        fechaCierre: "2025-02-10",
        estado: "digitalizado",
        placa: "HGO-2345",
        permiso: "PERM-2024-456",
        ruta: "Pachuca-Actopan",
        paginas: 32,
        descripcion: "Inspección técnica vehicular periódica"
    },
    {
        id: 4,
        numero: "EXP-STCH-2025-04570",
        titular: "Autobuses del Valle S.A.",
        tipo: "Solicitud de ruta",
        fechaApertura: "2025-02-05",
        fechaCierre: null,
        estado: "pendiente",
        placa: "HGO-5678, HGO-5679",
        permiso: "PERM-2025-789",
        ruta: "Pachuca-Huejutla (nueva)",
        paginas: 89,
        descripcion: "Solicitud de nueva ruta interurbana"
    },
    {
        id: 5,
        numero: "EXP-STCH-2025-04571",
        titular: "Carlos Martínez López",
        tipo: "Expediente de multa",
        fechaApertura: "2025-02-10",
        fechaCierre: "2025-02-25",
        estado: "archivado",
        placa: "HGO-3456",
        permiso: "PERM-2024-234",
        ruta: "Pachuca-Tizayuca",
        paginas: 67,
        descripcion: "Multa por exceso de velocidad en ruta asignada"
    }
];

// Variables de estado
let busquedasGuardadas = [];
let resultadosActuales = [];
let paginaActual = 1;
const resultadosPorPagina = 10;

// Inicialización
document.addEventListener('DOMContentLoaded', function() {
    cargarBusquedasGuardadas();
    document.getElementById('formBusqueda').addEventListener('submit', function(e) {
        e.preventDefault();
        realizarBusqueda();
    });
    
    // Configurar fecha actual como valor por defecto
    const hoy = new Date().toISOString().split('T')[0];
    document.getElementById('fechaHasta').value = hoy;
    
    // Hace 30 días como fecha por defecto "Desde"
    const hace30Dias = new Date();
    hace30Dias.setDate(hace30Dias.getDate() - 30);
    document.getElementById('fechaDesde').value = hace30Dias.toISOString().split('T')[0];
});

// Funciones principales
function realizarBusqueda() {
    const criterios = obtenerCriteriosBusqueda();
    
    // Simular búsqueda con datos de ejemplo
    resultadosActuales = filtrarExpedientes(criterios);
    
    // Actualizar UI
    actualizarResultados();
    actualizarContador();
    
    // Mostrar resultados
    document.getElementById('mensajeSinResultados').style.display = 'none';
}

function obtenerCriteriosBusqueda() {
    return {
        busquedaGeneral: document.getElementById('busquedaGeneral').value.toLowerCase(),
        tipoExpediente: document.getElementById('tipoExpediente').value,
        fechaDesde: document.getElementById('fechaDesde').value,
        fechaHasta: document.getElementById('fechaHasta').value,
        fechaEspecifica: document.getElementById('fechaEspecifica').value,
        nombreTitular: document.getElementById('nombreTitular').value.toLowerCase(),
        numeroExpediente: document.getElementById('numeroExpediente').value.toUpperCase(),
        estadoExpediente: document.getElementById('estadoExpediente').value,
        placaVehicular: document.getElementById('placaVehicular').value.toUpperCase(),
        numeroPermiso: document.getElementById('numeroPermiso').value.toUpperCase(),
        rutaAsignada: document.getElementById('rutaAsignada').value.toLowerCase()
    };
}

function filtrarExpedientes(criterios) {
    return expedientesEjemplo.filter(expediente => {
        // Búsqueda general
        if (criterios.busquedaGeneral) {
            const textoBusqueda = criterios.busquedaGeneral;
            const camposBusqueda = [
                expediente.numero,
                expediente.titular,
                expediente.tipo,
                expediente.descripcion,
                expediente.placa,
                expediente.permiso,
                expediente.ruta
            ].join(' ').toLowerCase();
            
            if (!camposBusqueda.includes(textoBusqueda)) {
                return false;
            }
        }
        
        // Filtro por tipo
        if (criterios.tipoExpediente && expediente.tipo.toLowerCase() !== criterios.tipoExpediente) {
            if (!expediente.tipo.toLowerCase().includes(criterios.tipoExpediente)) {
                return false;
            }
        }
        
        // Filtro por rango de fechas
        if (criterios.fechaDesde && expediente.fechaApertura < criterios.fechaDesde) {
            return false;
        }
        if (criterios.fechaHasta && expediente.fechaApertura > criterios.fechaHasta) {
            return false;
        }
        
        // Filtro por fecha específica
        if (criterios.fechaEspecifica && expediente.fechaApertura !== criterios.fechaEspecifica) {
            return false;
        }
        
        // Filtro por nombre
        if (criterios.nombreTitular && !expediente.titular.toLowerCase().includes(criterios.nombreTitular)) {
            return false;
        }
        
        // Filtro por número de expediente
        if (criterios.numeroExpediente && !expediente.numero.includes(criterios.numeroExpediente)) {
            return false;
        }
        
        // Filtro por estado
        if (criterios.estadoExpediente && expediente.estado !== criterios.estadoExpediente) {
            return false;
        }
        
        // Filtro por placa
        if (criterios.placaVehicular && !expediente.placa.includes(criterios.placaVehicular)) {
            return false;
        }
        
        // Filtro por permiso
        if (criterios.numeroPermiso && !expediente.permiso.includes(criterios.numeroPermiso)) {
            return false;
        }
        
        // Filtro por ruta
        if (criterios.rutaAsignada && !expediente.ruta.toLowerCase().includes(criterios.rutaAsignada)) {
            return false;
        }
        
        return true;
    });
}

function actualizarResultados() {
    const tbody = document.getElementById('tbodyResultados');
    tbody.innerHTML = '';
    
    const inicio = (paginaActual - 1) * resultadosPorPagina;
    const fin = inicio + resultadosPorPagina;
    const resultadosPagina = resultadosActuales.slice(inicio, fin);
    
    if (resultadosPagina.length === 0) {
        document.getElementById('mensajeSinResultados').style.display = '';
        return;
    }
    
    resultadosPagina.forEach(expediente => {
        const fila = document.createElement('tr');
        fila.className = 'hover:bg-gray-50';
        fila.innerHTML = `
            <td class="py-4 px-6">
                <input type="checkbox" class="rounded border-gray-300">
            </td>
            <td class="py-4 px-6">
                <div class="font-medium text-gray-900">${expediente.numero}</div>
                <div class="text-xs text-gray-500">${expediente.descripcion}</div>
            </td>
            <td class="py-4 px-6">
                <div class="font-medium">${expediente.titular}</div>
                <div class="text-xs text-gray-500">Placa: ${expediente.placa}</div>
            </td>
            <td class="py-4 px-6">
                <span class="px-3 py-1 text-xs rounded-full ${getColorTipo(expediente.tipo)}">
                    ${expediente.tipo}
                </span>
            </td>
            <td class="py-4 px-6 text-sm text-gray-900">
                ${formatearFecha(expediente.fechaApertura)}
            </td>
            <td class="py-4 px-6">
                <span class="px-3 py-1 text-xs rounded-full ${getColorEstado(expediente.estado)}">
                    ${getTextoEstado(expediente.estado)}
                </span>
            </td>
            <td class="py-4 px-6">
                <div class="flex space-x-2">
                    <button onclick="verDetalles(${expediente.id})" class="text-blue-600 hover:text-blue-800" title="Ver detalles">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button onclick="descargarExpediente(${expediente.id})" class="text-green-600 hover:text-green-800" title="Descargar">
                        <i class="fas fa-download"></i>
                    </button>
                    <button onclick="editarExpediente(${expediente.id})" class="text-yellow-600 hover:text-yellow-800" title="Editar">
                        <i class="fas fa-edit"></i>
                    </button>
                </div>
            </td>
        `;
        tbody.appendChild(fila);
    });
}

function actualizarContador() {
    const total = resultadosActuales.length;
    const inicio = Math.min((paginaActual - 1) * resultadosPorPagina + 1, total);
    const fin = Math.min(paginaActual * resultadosPorPagina, total);
    
    document.getElementById('contadorResultados').textContent = 
        `Mostrando ${inicio}-${fin} de ${total} expedientes`;
    document.getElementById('paginaInicio').textContent = inicio;
    document.getElementById('paginaFin').textContent = fin;
    document.getElementById('totalRegistros').textContent = total;
}

// Funciones auxiliares
function getColorEstado(estado) {
    const colores = {
        digitalizado: 'bg-green-100 text-green-800',
        pendiente: 'bg-yellow-100 text-yellow-800',
        revision: 'bg-blue-100 text-blue-800',
        archivado: 'bg-gray-100 text-gray-800',
        eliminado: 'bg-red-100 text-red-800'
    };
    return colores[estado] || 'bg-gray-100 text-gray-800';
}

function getTextoEstado(estado) {
    const textos = {
        digitalizado: 'Digitalizado',
        pendiente: 'Pendiente',
        revision: 'En revisión',
        archivado: 'Archivado',
        eliminado: 'Eliminado'
    };
    return textos[estado] || estado;
}

function getColorTipo(tipo) {
    if (tipo.includes('Licencia')) return 'bg-purple-100 text-purple-800';
    if (tipo.includes('Renovación')) return 'bg-indigo-100 text-indigo-800';
    if (tipo.includes('Inspección')) return 'bg-teal-100 text-teal-800';
    if (tipo.includes('Solicitud')) return 'bg-orange-100 text-orange-800';
    if (tipo.includes('multa')) return 'bg-red-100 text-red-800';
    return 'bg-gray-100 text-gray-800';
}

function formatearFecha(fechaISO) {
    const fecha = new Date(fechaISO);
    return fecha.toLocaleDateString('es-MX', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
    });
}

// Funciones de UI
function limpiarBusqueda() {
    document.getElementById('formBusqueda').reset();
    
    // Restablecer fechas por defecto
    const hoy = new Date().toISOString().split('T')[0];
    const hace30Dias = new Date();
    hace30Dias.setDate(hace30Dias.getDate() - 30);
    
    document.getElementById('fechaHasta').value = hoy;
    document.getElementById('fechaDesde').value = hace30Dias.toISOString().split('T')[0];
    
    resultadosActuales = [];
    actualizarResultados();
    actualizarContador();
    document.getElementById('mensajeSinResultados').style.display = '';
}

function limpiarFechaEspecifica() {
    document.getElementById('fechaEspecifica').value = '';
}

function guardarBusqueda() {
    const criterios = obtenerCriteriosBusqueda();
    const nombre = prompt('Nombre para esta búsqueda:', `Búsqueda ${new Date().toLocaleDateString()}`);
    
    if (nombre) {
        busquedasGuardadas.push({
            nombre,
            criterios,
            fecha: new Date().toISOString()
        });
        localStorage.setItem('busquedasGuardadasSTCH', JSON.stringify(busquedasGuardadas));
        cargarBusquedasGuardadas();
        alert('Búsqueda guardada correctamente');
    }
}

function cargarBusquedasGuardadas() {
    const guardadas = localStorage.getItem('busquedasGuardadasSTCH');
    if (guardadas) {
        busquedasGuardadas = JSON.parse(guardadas);
        actualizarPanelBusquedas();
    }
}

function actualizarPanelBusquedas() {
    const panel = document.querySelector('#panelBusquedasGuardadas > div:nth-child(2)');
    
    if (busquedasGuardadas.length === 0) {
        panel.innerHTML = `
            <div class="text-center text-gray-500 py-8">
                <i class="fas fa-bookmark text-2xl mb-2"></i>
                <p class="text-sm">No hay búsquedas guardadas</p>
            </div>
        `;
        return;
    }
    
    panel.innerHTML = busquedasGuardadas.map((busqueda, index) => `
        <div class="p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer" onclick="cargarBusquedaGuardada(${index})">
            <div class="flex justify-between items-start">
                <div>
                    <p class="font-medium text-sm text-gray-800">${busqueda.nombre}</p>
                    <p class="text-xs text-gray-500">${new Date(busqueda.fecha).toLocaleDateString()}</p>
                </div>
                <button onclick="eliminarBusquedaGuardada(${index})" class="text-gray-400 hover:text-red-500">
                    <i class="fas fa-trash text-xs"></i>
                </button>
            </div>
        </div>
    `).join('');
}

function cargarBusquedaGuardada(index) {
    const busqueda = busquedasGuardadas[index];
    
    // Cargar criterios en el formulario
    document.getElementById('busquedaGeneral').value = busqueda.criterios.busquedaGeneral || '';
    document.getElementById('tipoExpediente').value = busqueda.criterios.tipoExpediente || '';
    document.getElementById('fechaDesde').value = busqueda.criterios.fechaDesde || '';
    document.getElementById('fechaHasta').value = busqueda.criterios.fechaHasta || '';
    document.getElementById('fechaEspecifica').value = busqueda.criterios.fechaEspecifica || '';
    document.getElementById('nombreTitular').value = busqueda.criterios.nombreTitular || '';
    document.getElementById('numeroExpediente').value = busqueda.criterios.numeroExpediente || '';
    document.getElementById('estadoExpediente').value = busqueda.criterios.estadoExpediente || '';
    document.getElementById('placaVehicular').value = busqueda.criterios.placaVehicular || '';
    document.getElementById('numeroPermiso').value = busqueda.criterios.numeroPermiso || '';
    document.getElementById('rutaAsignada').value = busqueda.criterios.rutaAsignada || '';
    
    // Realizar la búsqueda automáticamente
    realizarBusqueda();
    toggleBusquedasGuardadas();
}

function eliminarBusquedaGuardada(index) {
    if (confirm('¿Eliminar esta búsqueda guardada?')) {
        busquedasGuardadas.splice(index, 1);
        localStorage.setItem('busquedasGuardadasSTCH', JSON.stringify(busquedasGuardadas));
        actualizarPanelBusquedas();
    }
}

function toggleBusquedasGuardadas() {
    const panel = document.getElementById('panelBusquedasGuardadas');
    const estaVisible = !panel.classList.contains('translate-x-full');
    
    if (estaVisible) {
        panel.classList.add('translate-x-full');
    } else {
        panel.classList.remove('translate-x-full');
    }
}

// Funciones de expediente
function verDetalles(id) {
    const expediente = expedientesEjemplo.find(e => e.id === id);
    
    document.getElementById('contenidoModal').innerHTML = `
        <div class="space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h4 class="text-sm font-medium text-gray-500 mb-1">Número de expediente</h4>
                    <p class="text-lg font-semibold">${expediente.numero}</p>
                </div>
                <div>
                    <h4 class="text-sm font-medium text-gray-500 mb-1">Estado</h4>
                    <span class="px-3 py-1 text-sm rounded-full ${getColorEstado(expediente.estado)}">
                        ${getTextoEstado(expediente.estado)}
                    </span>
                </div>
            </div>
            
            <div>
                <h4 class="text-sm font-medium text-gray-500 mb-1">Titular</h4>
                <p class="text-lg">${expediente.titular}</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <h4 class="text-sm font-medium text-gray-500 mb-1">Tipo</h4>
                    <p>${expediente.tipo}</p>
                </div>
                <div>
                    <h4 class="text-sm font-medium text-gray-500 mb-1">Fecha de apertura</h4>
                    <p>${formatearFecha(expediente.fechaApertura)}</p>
                </div>
                <div>
                    <h4 class="text-sm font-medium text-gray-500 mb-1">Páginas</h4>
                    <p>${expediente.paginas} páginas</p>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h4 class="text-sm font-medium text-gray-500 mb-1">Placa vehicular</h4>
                    <p>${expediente.placa}</p>
                </div>
                <div>
                    <h4 class="text-sm font-medium text-gray-500 mb-1">Número de permiso</h4>
                    <p>${expediente.permiso}</p>
                </div>
            </div>
            
            <div>
                <h4 class="text-sm font-medium text-gray-500 mb-1">Ruta asignada</h4>
                <p>${expediente.ruta}</p>
            </div>
            
            <div>
                <h4 class="text-sm font-medium text-gray-500 mb-1">Descripción</h4>
                <p class="text-gray-700">${expediente.descripcion}</p>
            </div>
            
            <div class="pt-6 border-t">
                <div class="flex space-x-3">
                    <button onclick="descargarExpediente(${expediente.id})" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        <i class="fas fa-download mr-2"></i>Descargar PDF
                    </button>
                    <button onclick="editarExpediente(${expediente.id})" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                        <i class="fas fa-edit mr-2"></i>Editar
                    </button>
                    <button onclick="cerrarModal()" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                        Cerrar
                    </button>
                </div>
            </div>
        </div>
    `;
    
    document.getElementById('modalDetalles').classList.remove('hidden');
}

function cerrarModal() {
    document.getElementById('modalDetalles').classList.add('hidden');
}

function descargarExpediente(id) {
    alert(`Iniciando descarga del expediente ${id}`);
    // Aquí iría la lógica real de descarga
}

function editarExpediente(id) {
    alert(`Editando expediente ${id}`);
    // Aquí iría la navegación a la página de edición
}
</script>

<style>
/* Estilos adicionales para mejor UX */
input[type="date"]::-webkit-calendar-picker-indicator {
    cursor: pointer;
    opacity: 0.6;
}

input[type="date"]::-webkit-calendar-picker-indicator:hover {
    opacity: 1;
}

#panelBusquedasGuardadas {
    height: 400px;
    z-index: 40;
}

#btnToggleBusquedas {
    z-index: 30;
}

/* Scroll personalizado */
#panelBusquedasGuardadas > div:nth-child(2)::-webkit-scrollbar {
    width: 6px;
}

#panelBusquedasGuardadas > div:nth-child(2)::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

#panelBusquedasGuardadas > div:nth-child(2)::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 3px;
}

#panelBusquedasGuardadas > div:nth-child(2)::-webkit-scrollbar-thumb:hover {
    background: #555;
}
</style>