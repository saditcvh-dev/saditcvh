<!-- Dashboard Cards Component -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
    
    <!-- Mensaje de error general -->
    <div *ngIf="hasError() && !allCardsError()" class="col-span-full mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded text-sm text-yellow-700">
        <i class="fas fa-exclamation-triangle mr-2"></i>
        {{ errorMessage() }} - Mostrando datos previos
    </div>
    
    <div *ngIf="allCardsError()" class="col-span-full mb-4 p-3 bg-red-50 border border-red-200 rounded text-sm text-red-700">
        <i class="fas fa-exclamation-circle mr-2"></i>
        No se pudieron cargar los datos. 
        <button (click)="refreshData()" class="ml-2 underline font-medium hover:text-red-800">
            Reintentar
        </button>
    </div>
    
    <!-- Iterar sobre las cards -->
    <div *ngFor="let card of cards()" 
         class="bg-white dark:bg-[#050505] rounded-xl border border-gray-200 dark:border-neutral-900 p-5 shadow-sm">
        
        <!-- Estado de carga -->
        <div *ngIf="card.loading" class="animate-pulse">
            <div class="flex justify-between items-start mb-4">
                <div class="space-y-3">
                    <div class="h-4 w-24 bg-gray-200 dark:bg-gray-700 rounded"></div>
                    <div class="h-8 w-32 bg-gray-300 dark:bg-gray-600 rounded"></div>
                </div>
                <div class="w-10 h-10 bg-gray-200 dark:bg-gray-700 rounded-lg"></div>
            </div>
            <div class="h-2 w-20 bg-gray-200 dark:bg-gray-700 rounded mt-4"></div>
        </div>
        
        <!-- Estado normal o con error -->
        <div *ngIf="!card.loading">
            <div class="flex justify-between items-start">
                <div>
                    <p class="text-sm font-medium text-gray-600 dark:text-gray-400">{{ card.title }}</p>
                    <p class="text-3xl font-bold mt-2" [style.color]="card.color">
                        {{ formatValue(card.value) }}
                    </p>
                </div>
                <div class="w-12 h-12 rounded-lg flex items-center justify-center"
                     [style.background-color]="card.color + '20'">
                    <i [class]="card.icon" [style.color]="card.color"></i>
                </div>
            </div>
            
            <!-- Descripción y tendencia -->
            <div class="mt-4 flex items-center justify-between">
                <p class="text-xs text-gray-500 dark:text-gray-500">{{ card.description }}</p>
                
                <div *ngIf="!card.error" class="flex items-center space-x-1">
                    <i [class]="'fas fa-arrow-' + (card.trend.isPositive ? 'up' : 'down') 
                       + ' text-' + (card.trend.isPositive ? 'green' : 'red') + '-500 text-xs'"></i>
                    <span [class]="'text-xs font-medium ' + 
                                 (card.trend.isPositive ? 'text-green-600' : 'text-red-600')">
                        {{ formatTrend(card.trend.value) }}
                    </span>
                </div>
                
                <!-- Indicador de error -->
                <div *ngIf="card.error" class="text-xs text-red-500">
                    <i class="fas fa-exclamation-circle mr-1"></i>
                    Error
                </div>
            </div>
        </div>
    </div>
    
    <!-- Información de última actualización -->
    <div class="col-span-full flex justify-end items-center mt-4 text-xs text-gray-400 dark:text-gray-500">
        <div class="flex items-center space-x-3">
            <span>
                <i class="fas fa-clock mr-1"></i>
                Última actualización: {{ lastUpdateTimeFormatted() }}
                <span *ngIf="updateAgoText()"> ({{ updateAgoText() }})</span>
            </span>
            
            <button 
                (click)="refreshData()" 
                [disabled]="isLoading()"
                class="p-1.5 text-[#691831] dark:text-[#9f4a5f] hover:bg-[#691831]/10 dark:hover:bg-[#9f4a5f]/20 rounded-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                title="Actualizar datos"
            >
                <i class="fas fa-sync-alt text-sm" [class.fa-spin]="isLoading()"></i>
            </button>
        </div>
    </div>
</div>