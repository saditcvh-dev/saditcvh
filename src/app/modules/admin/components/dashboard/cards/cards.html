<!-- ============================================================
     KPI PRINCIPALES (DINÁMICOS)
============================================================ -->

<div class="mb-6">
  <!-- Debug info - Puedes eliminar esto después -->
  <div *ngIf="false" class="mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded text-xs">
    <strong>Debug Info:</strong><br>
    isLoading: {{ isLoading }}<br>
    hasError: {{ hasError }}<br>
    errorMessage: {{ errorMessage }}<br>
    Cards: {{ cards | json }}<br>
    Last Update: {{ getLastUpdateTime() }}
  </div>

  <div class="flex justify-between items-center mb-4">
    <div>
      <p class="text-xs text-gray-500" *ngIf="getLastUpdateTime()">
        <i class="fas fa-clock mr-1"></i>
        Actualizado {{ getUpdateAgo() }}
      </p>
    </div>
    
    <div class="flex items-center space-x-2">
      <span class="text-xs text-gray-500" *ngIf="getLastUpdateTime()">
        {{ getLastUpdateTime() }}
      </span>
      <button 
        (click)="refreshData()" 
        [disabled]="isLoading"
        class="p-2 text-[#691831] hover:bg-[#691831]/10 rounded-full transition-colors"
        title="Actualizar datos"
      >
        <i class="fas fa-sync-alt text-sm" [class.fa-spin]="isLoading"></i>
      </button>
    </div>
  </div>
  
  <!-- Mensaje de error -->
  <div *ngIf="hasError && !isLoading" class="mb-4 p-3 bg-red-50 border border-red-200 rounded text-sm text-red-700">
    <i class="fas fa-exclamation-circle mr-2"></i>
    {{ errorMessage }}
  </div>
</div>

<!-- Grid de 4 tarjetas -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
  <div
    *ngFor="let card of cards; let i = index"
    [ngClass]="getCardClass(card)"
  >
    <div class="flex items-center justify-between">
      <div>
        <p class="text-sm font-medium text-gray-500 mb-2">
          <i [class]="card.icon + ' mr-2 text-[#691831]'"></i>
          {{ card.title }}
        </p>

        <!-- VALOR DINÁMICO -->
        <h3 class="text-2xl font-bold text-[#691831]">
          {{ formatValue(card.value) }}
        </h3>

        <!-- DESCRIPCIÓN / TREND -->
        <p
          *ngIf="card.trend"
          class="text-xs mt-3 flex items-center"
          [ngClass]="card.trend.isPositive ? 'text-green-600' : 'text-red-600'"
        >
          <i
            class="fas mr-1"
            [ngClass]="card.trend.isPositive ? 'fa-arrow-up' : 'fa-arrow-down'"
          ></i>
          {{ formatTrend(card.trend.value) }}
        </p>

        <p
          *ngIf="card.description"
          class="text-xs text-gray-500 mt-1"
        >
          {{ card.description }}
        </p>
      </div>

      <div class="w-12 h-12 rounded-full bg-[#691831]/10 flex items-center justify-center">
        <i [class]="card.icon + ' text-[#691831] text-xl'"></i>
      </div>
    </div>
    
    <!-- Indicador de estado -->
    <div class="mt-4">
      <div *ngIf="card.loading" class="h-1 w-full bg-gray-200 rounded-full overflow-hidden">
        <div class="h-full bg-[#691831] animate-pulse w-1/3"></div>
      </div>
      <div *ngIf="card.error" class="text-xs text-red-500">
        <i class="fas fa-exclamation-triangle mr-1"></i> Error
      </div>
    </div>
  </div>
</div>

<!-- Nota informativa -->
<div class="text-center mt-6">
  <p class="text-xs text-gray-400">
    <i class="fas fa-info-circle mr-1"></i>
    Los datos se actualizan automáticamente cada 30 segundos
  </p>
</div>